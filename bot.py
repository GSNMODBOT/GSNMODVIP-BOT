import telebot
from config import TOKEN, ADMIN_ID, CHANNEL, CHANNEL_LINK, CHANNEL_ID
import random
import time
import json
import os
from datetime import datetime, timedelta
import requests
import re

# ========== ุฅุนุฏุงุฏุงุช ุงูุจูุช ==========
bot = telebot.TeleBot(TOKEN)
bot.skip_pending = True

# ========== ูููุงุช ุงูุชุฎุฒูู ==========
ุฐุงูุฑุฉ_ุงููุณุชุฎุฏููู = "user_memory.json"
ููู_ุงููุณุชููุงุช = "user_levels.json"
ููู_ุงููุดุงูู = "problem_solutions.json"
ููู_ุงูุชููููุงุช = "ratings.json"
ููู_ุงูุงูุฌุงุฒุงุช = "achievements.json"
ููู_ุงูุดุฎุตูุงุช = "personalities.json"

# ========== ุชุญููู ูุญูุธ ุงูุจูุงูุงุช ==========
def ุชุญููู_json(ููู, default={}):
    try:
        with open(ููู, 'r', encoding='utf-8') as f:
            return json.load(f)
    except:
        return default

def ุญูุธ_json(ููู, data):
    with open(ููู, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=4)

# ุชุญููู ูู ุงูุจูุงูุงุช
ุฐุงูุฑุฉ = ุชุญููู_json(ุฐุงูุฑุฉ_ุงููุณุชุฎุฏููู)
ูุณุชููุงุช = ุชุญููู_json(ููู_ุงููุณุชููุงุช)
ูุงุนุฏุฉ_ูุดุงูู = ุชุญููู_json(ููู_ุงููุดุงูู)
ุชููููุงุช = ุชุญููู_json(ููู_ุงูุชููููุงุช)
ุงูุฌุงุฒุงุช = ุชุญููู_json(ููู_ุงูุงูุฌุงุฒุงุช)
ุดุฎุตูุงุช = ุชุญููู_json(ููู_ุงูุดุฎุตูุงุช, {
    "ุฌุฏู": {"ุงูููุฌู": "๐", "ูุตู": "ุฃูุง ุจูุช ูุญุชุฑู ูุฌุงุฏ"},
    "ููููุฏู": {"ุงูููุฌู": "๐", "ูุตู": "ุฃูุง ุจูุช ููุงูู ุฃุญุจ ุฃุถุญู"},
    "ุชููู": {"ุงูููุฌู": "๐ค", "ูุตู": "ุฃูุง ุจูุช ุชููู ุจุญุช"},
    "ุฎุจูุฑ": {"ุงูููุฌู": "๐ฎ", "ูุตู": "ุฎุจูุฑ ุจุจุฌู ูุงูุช"}
})

# ========== ุฏุงูุฉ ุชุญููู ุฑุงุจุท ุงูููุดูุฑ ุฅูู ุตูุฑุฉ ==========
def ุฑุงุจุท_ุงูุตูุฑุฉ(ุฑุงุจุท):
    return f"https://t.me/kenan_mod_2/{ุฑุงุจุท.split('/')[-1]}?embed=1"

# ========== ูุณุฎ ุจุจุฌู ูุงูุช ==========
ูุณุฎ_ุจุจุฌู = {
    "v1": {
        "ุงุณู": "๐ฅ ุจุจุฌู ูุงูุช ูุณุฎุฉ 1 โข ุงุณุชูุฑุงุฑ ุชุงู",
        "ุญุฌู": "680 MB",
        "ูุตู": "โข โ Anti-Ban 100%\nโข โก 60 FPS ุจุฏูู ุชูุทูุน",
        "ููุฏ": "https://t.me/kenan_mod_2/37",
        "ุตูุฑุฉ": "https://t.me/kenan_mod_2/36",
        "ููุน_ุงูุฏุฎูู": "ุจุฏูู ููุฏ",
        "ุชูููู": 4.5
    },
    "v2": {
        "ุงุณู": "โก ุจุจุฌู ูุงูุช ูุณุฎุฉ 2 โข ุณุฑุนุฉ ุงูุฃุณุงุทูุฑ",
        "ุญุฌู": "690 MB",
        "ูุตู": "โข ๐ ุณุฑุนุฉ ุชุตููุจ ุฎุงุฑูุฉ\nโข ๐ฏ ุฑููููู 0%\nโข ๐ซ Aimbot ุชููุงุฆู",
        "ููุฏ": "https://t.me/kenan_mod_2/44",
        "ุตูุฑุฉ": "https://t.me/kenan_mod_2/39",
        "ููุน_ุงูุฏุฎูู": "ุจุฏูู ููุฏ",
        "ุชูููู": 4.8
    },
    "v3": {
        "ุงุณู": "๐ฏ ุจุจุฌู ูุงูุช ูุณุฎุฉ 3 โข ููุฌูุงูุงุช ุงูุถุนููุฉ",
        "ุญุฌู": "675 MB",
        "ูุตู": "โข ๐ฑ ุชุดุบูู ุนูู 2 ุฌูุฌุง ุฑุงู\nโข ๐ ุจุทุงุฑูุฉ ุฃูู ุงุณุชููุงู\nโข ุจุฏูู OBB",
        "ููุฏ": "https://t.me/kenan_mod_2/47",
        "ุตูุฑุฉ": "https://t.me/kenan_mod_2/45",
        "ููุน_ุงูุฏุฎูู": "ุจุฏูู ููุฏ",
        "ุชูููู": 4.7
    },
    "v4": {
        "ุงุณู": "๐ ุจุจุฌู ูุงูุช ูุณุฎุฉ 4 โข ุณููุงุช ุญุตุฑูุฉ",
        "ุญุฌู": "ุบูุฑ ูุชุงุญ",
        "ูุตู": "โข ๐ ุณููุงุช ูุงุฏุฑุฉ\nโข ุดุฏุงุช ูุฌุงููุฉ\nโข ููุฏ ุงูุฅุนุฏุงุฏ",
        "ููุฏ": "โ ูุง ููุฌุฏ ููุฏ ุจุนุฏ",
        "ุตูุฑุฉ": "https://t.me/kenan_mod_2/36",
        "ููุน_ุงูุฏุฎูู": "โ",
        "ุชูููู": 0
    }
}

# ========== ุงูุชุญูู ูู ุงูุงุดุชุฑุงู ==========
def ูุดุชุฑู(user_id):
    try:
        member = bot.get_chat_member(CHANNEL_ID, user_id)
        return member.status in ['member', 'administrator', 'creator']
    except:
        return False

# ========== ุชุญุฏูุซ ุฐุงูุฑุฉ ุงููุณุชุฎุฏู ==========
def ุชุญุฏูุซ_ุงูุฐุงูุฑุฉ(user_id, user_name, ุฑุณุงูุฉ):
    if str(user_id) not in ุฐุงูุฑุฉ:
        ุฐุงูุฑุฉ[str(user_id)] = {
            "ุงูุงุณู": user_name,
            "ุงููุญุงุฏุซุงุช": [],
            "ุงุฎุฑ_ุฒูุงุฑุฉ": str(datetime.now()),
            "ุนุฏุฏ_ุงูุฒูุงุฑุงุช": 1,
            "ุงุฎุฑ_ูุณุฎุฉ": None,
            "ุงูููุงุท": 0,
            "ุงูุดุฎุตูุฉ": "ุฌุฏู",
            "ุงููุดุงุนุฑ": [],
            "ุงูุงูุฌุงุฒุงุช": [],
            "ุงููุณุชูู": 1,
            "ุงูุฎุจุฑุฉ": 0
        }
    else:
        ุฐุงูุฑุฉ[str(user_id)]["ุนุฏุฏ_ุงูุฒูุงุฑุงุช"] += 1
        ุฐุงูุฑุฉ[str(user_id)]["ุงุฎุฑ_ุฒูุงุฑุฉ"] = str(datetime.now())
    
    ุฐุงูุฑุฉ[str(user_id)]["ุงููุญุงุฏุซุงุช"].append({
        "ุงูููุช": str(datetime.now()),
        "ุงูุฑุณุงูุฉ": ุฑุณุงูุฉ[:50]
    })
    if len(ุฐุงูุฑุฉ[str(user_id)]["ุงููุญุงุฏุซุงุช"]) > 20:
        ุฐุงูุฑุฉ[str(user_id)]["ุงููุญุงุฏุซุงุช"].pop(0)
    
    ุญูุธ_json(ุฐุงูุฑุฉ_ุงููุณุชุฎุฏููู, ุฐุงูุฑุฉ)

# ========== ุชุญููู ุงููุดุงุนุฑ ==========
def ุชุญููู_ุงููุดุงุนุฑ(text):
    ูููุงุช_ุญุฒููุฉ = ["ุญุฒูู", "ุชุนุจุงู", "ุฒุนูุงู", "ูุถุงูู", "ูู", "ุถูู", "ุจูุงุก", "sad", "depressed", "heartbroken"]
    ูููุงุช_ุณุนูุฏุฉ = ["ูุฑุญุงู", "ูุจุณูุท", "ุณุนูุฏ", "ุญูู", "ุฌุงูุฏ", "ุฑุงุฆุน", "happy", "joy", "excited"]
    ูููุงุช_ุบุถุจ = ["ุบุถุจุงู", "ุฒุนูุช", "ุญุฑุงู", "ูุนู", "ุบุถุจ", "angry", "mad", "furious"]
    ูููุงุช_ุฏูุดุฉ = ["ูุงู", "ูุฐูู", "ุนุฌูุจ", "ุฑููุจ", "wow", "amazing", "incredible"]
    
    if any(k in text for k in ูููุงุช_ุญุฒููุฉ):
        return "ุญุฒูู"
    if any(k in text for k in ูููุงุช_ุณุนูุฏุฉ):
        return "ุณุนูุฏ"
    if any(k in text for k in ูููุงุช_ุบุถุจ):
        return "ุบุถุจุงู"
    if any(k in text for k in ูููุงุช_ุฏูุดุฉ):
        return "ููุฏูุด"
    return "ูุญุงูุฏ"

# ========== ุฑุฏูุฏ ุฐููุฉ ุญุณุจ ุงููุดุงุนุฑ ==========
def ุฑุฏ_ุนุงุทูู(ูุดุงุนุฑ, user_name):
    ุฑุฏูุฏ = {
        "ุญุฒูู": [f"๐ ุงููู ููุฑุฌ ููู {user_name}ุ ุฃูุง ูุนุงู", f"๐ค ูุง ุชุญุฒูุ ุฃูุง ููุง ุนุดุงู ุฃุณูุนู", f"๐ ูู ุชุญุจ ุฃุชููู ูุนุงูุ ุฃูุง ููุฌูุฏ"],
        "ุณุนูุฏ": [f"๐ฅณ ุงููู ูุฏุงูู ุงููุฑุญุฉ {user_name}", f"โจ ูุฑุญุชู ุชูุฑุญูู ูุงููู", f"๐ ุชุณููููุ ุฏุงุฆููุง ูุจุณูุท ุฅูู ูุนุงูุง"],
        "ุบุถุจุงู": [f"๐ค ุงูุฏู {user_name}ุ ุฎุฐ ููุณ", f"๐ ุงูุบุถุจ ูุง ูุญู ุงููุดููุฉุ ููู ููู", f"๐ง ุฎุฐ ุฑุงุญุฉ ูุดููุฉ ูุฏูุก"],
        "ููุฏูุด": [f"๐ฎ ุญุงุฌุฉ ูุฐููุฉ ุตุญุ", f"๐ ุฃูุง ููุงู ููุฏูุด!", f"๐คฏ ููุช ูู ุงูุจูุช ุญูู ุฃุณุทูุฑุฉ"],
        "ูุญุงูุฏ": [f"๐น ุฃููุงู {user_name}", f"๐ค ุฃูุง ููุงุ ุชุญุช ุฃูุฑู", f"๐ฌ ููู ุฃูุฏุฑ ุฃุณุงุนุฏูุ"]
    }
    return random.choice(ุฑุฏูุฏ.get(ูุดุงุนุฑ, ุฑุฏูุฏ["ูุญุงูุฏ"]))

# ========== ูุธุงู ุงูุฎุจุฑุฉ ูุงููุณุชููุงุช ==========
def ุงุถุงูุฉ_ุฎุจุฑุฉ(user_id, points=10):
    if str(user_id) in ุฐุงูุฑุฉ:
        ุฐุงูุฑุฉ[str(user_id)]["ุงูุฎุจุฑุฉ"] = ุฐุงูุฑุฉ[str(user_id)].get("ุงูุฎุจุฑุฉ", 0) + points
        ุฎุจุฑุฉ = ุฐุงูุฑุฉ[str(user_id)]["ุงูุฎุจุฑุฉ"]
        
        # ุญุณุงุจ ุงููุณุชูู
        if ุฎุจุฑุฉ < 100:
            ูุณุชูู = 1
        elif ุฎุจุฑุฉ < 300:
            ูุณุชูู = 2
        elif ุฎุจุฑุฉ < 600:
            ูุณุชูู = 3
        elif ุฎุจุฑุฉ < 1000:
            ูุณุชูู = 4
        else:
            ูุณุชูู = 5
        
        ุฐุงูุฑุฉ[str(user_id)]["ุงููุณุชูู"] = ูุณุชูู
        ุญูุธ_json(ุฐุงูุฑุฉ_ุงููุณุชุฎุฏููู, ุฐุงูุฑุฉ)
        return ูุณุชูู
    return 1

# ========== ูุธุงู ุงูุฅูุฌุงุฒุงุช ==========
ุงูุฌุงุฒุงุช_ุงููู = {
    "ุงูู_ูุญุงุฏุซุฉ": {"ุงุณู": "๐ฏ ุฃูู ุฎุทูุฉ", "ุดุฑุท": 1, "ููุงุท": 10},
    "ุนุดุฑ_ูุญุงุฏุซุงุช": {"ุงุณู": "๐ฌ ูุชุญุฏุซ ูุญุชุฑู", "ุดุฑุท": 10, "ููุงุท": 50},
    "ุฎูุณูู_ูุญุงุฏุซุฉ": {"ุงุณู": "๐ฃ๏ธ ุฃุณุทูุฑุฉ ุงูููุงู", "ุดุฑุท": 50, "ููุงุท": 200},
    "ุงูู_ุชุญููู": {"ุงุณู": "๐ฅ ุฃูู ุชุญููู", "ุดุฑุท": 1, "ููุงุท": 30},
    "ุชูููู_ุงูู": {"ุงุณู": "โญ ูุงูุฏ ูุญุชุฑู", "ุดุฑุท": 1, "ููุงุท": 20}
}

def ุชุญูู_ุงูุฌุงุฒุงุช(user_id):
    if str(user_id) not in ุฐุงูุฑุฉ:
        return []
    
    user = ุฐุงูุฑุฉ[str(user_id)]
    ูุญุงุฏุซุงุช = len(user.get("ุงููุญุงุฏุซุงุช", []))
    ููุฌุฒุงุช_ุฌุฏูุฏุฉ = []
    
    for key, data in ุงูุฌุงุฒุงุช_ุงููู.items():
        if key not in user.get("ุงูุงูุฌุงุฒุงุช", []):
            if (key == "ุงูู_ูุญุงุฏุซุฉ" and ูุญุงุฏุซุงุช >= 1) or \
               (key == "ุนุดุฑ_ูุญุงุฏุซุงุช" and ูุญุงุฏุซุงุช >= 10) or \
               (key == "ุฎูุณูู_ูุญุงุฏุซุฉ" and ูุญุงุฏุซุงุช >= 50):
                user["ุงูุงูุฌุงุฒุงุช"].append(key)
                user["ุงูููุงุท"] = user.get("ุงูููุงุท", 0) + data["ููุงุท"]
                ููุฌุฒุงุช_ุฌุฏูุฏุฉ.append(data["ุงุณู"])
    
    if ููุฌุฒุงุช_ุฌุฏูุฏุฉ:
        ุญูุธ_json(ุฐุงูุฑุฉ_ุงููุณุชุฎุฏููู, ุฐุงูุฑุฉ)
    
    return ููุฌุฒุงุช_ุฌุฏูุฏุฉ

# ========== ูุธุงู ุชููุนุงุช ุฐููุฉ ==========
def ุชููุน_ุฐูู():
    ุชููุนุงุช = [
        "๐ฎ ุชููุนุงุชู ุชููู: ุงููุณุฎุฉ ุงูุฌุงูุฉ ุฑุงุญ ุชููู ูููุง ุณููุงุช ูุงุฏุฑุฉ",
        "๐ค ุฃุชููุน ูุฒูู ุชุญุฏูุซ ููู ุงูุดูุฑ ุงูุฌุงู",
        "โก ุงูุชููุนุงุช: ูู 2026 ุฑุงุญ ูุฒูุฏ ุนุฏุฏ ุงููุณุชุฎุฏููู 50%",
        "๐ฏ ูุชููุน ูุฒูู ูุณุฎุฉ 64 ุจุช ูุฑูุจูุง",
        "๐ ุญุณุจ ุชุญููููุ v2 ุฑุงุญ ุชููู ุงูุฃูุซุฑ ุชุญููููุง ูุงูุดูุฑ"
    ]
    return random.choice(ุชููุนุงุช)

# ========== ูุธุงู ุชูููู ุงููุณุฎ ==========
@bot.message_handler(commands=['ููู', 'rate'])
def ุชูููู_ูุณุฎุฉ(message):
    try:
        parts = message.text.split()
        if len(parts) < 3:
            bot.reply_to(message, "โ๏ธ ุงุณุชุฎุฏู: /ููู ุฑูู ุงููุณุฎุฉ ุงูุชูููู\nูุซุงู: /ููู 2 5")
            return
        
        ุฑูู = parts[1]
        ุชูููู = float(parts[2])
        
        if ุชูููู < 0 or ุชูููู > 5:
            bot.reply_to(message, "โ ุงูุชูููู ูู 0 ุฅูู 5")
            return
        
        ูุณุฎุฉ_key = f"v{ุฑูู}"
        if ูุณุฎุฉ_key not in ูุณุฎ_ุจุจุฌู:
            bot.reply_to(message, "โ ูุฐู ุงููุณุฎุฉ ุบูุฑ ููุฌูุฏุฉ")
            return
        
        if str(message.from_user.id) not in ุชููููุงุช:
            ุชููููุงุช[str(message.from_user.id)] = {}
        
        ุชููููุงุช[str(message.from_user.id)][ูุณุฎุฉ_key] = ุชูููู
        ุญูุธ_json(ููู_ุงูุชููููุงุช, ุชููููุงุช)
        
        # ุญุณุงุจ ูุชูุณุท ุงูุชูููู
        ุฌููุน_ุงูุชููููุงุช = [t[ูุณุฎุฉ_key] for t in ุชููููุงุช.values() if ูุณุฎุฉ_key in t]
        ูุนุฏู = sum(ุฌููุน_ุงูุชููููุงุช) / len(ุฌููุน_ุงูุชููููุงุช)
        ูุณุฎ_ุจุจุฌู[ูุณุฎุฉ_key]["ุชูููู"] = round(ูุนุฏู, 1)
        
        ุงุถุงูุฉ_ุฎุจุฑุฉ(message.from_user.id, 20)
        bot.reply_to(message, f"โ ุชู ุชุณุฌูู ุชููููู: {ุชูููู}/5\nโญ ูุชูุณุท ุงูุชูููู: {round(ูุนุฏู, 1)}/5")
        
    except Exception as e:
        bot.reply_to(message, f"โ ุฎุทุฃ: {e}")

# ========== ูุธุงู ูุณุงุจูุงุช ==========
ูุณุงุจูุงุช = {}
ุฌูุงุฆุฒ_ูุณุงุจูุงุช = ["ูุณุฎุฉ ุญุตุฑูุฉ ูุฌุงููุฉ", "100 ููุทุฉ ุฎุจุฑุฉ", "ูุณุงู ุฐูุจู", "ููุจูู ุฎุตู"]

@bot.message_handler(commands=['ูุณุงุจูุฉ', 'contest'])
def ูุณุงุจูุฉ_ููููุฉ(message):
    user_id = message.from_user.id
    ุงูููู = datetime.now().strftime("%Y-%m-%d")
    
    if user_id in ูุณุงุจูุงุช and ูุณุงุจูุงุช[user_id] == ุงูููู:
        bot.reply_to(message, "โ ุดุงุฑูุช ุงููููุ ุจูุฑุฉ ุฅู ุดุงุก ุงููู")
        return
    
    ุณุคุงู = random.choice([
        "ูู ุนุฏุฏ ูุณุฎ ุจุจุฌู ูุงูุช ูู ุงูุจูุชุ",
        "ุฃูุถู ูุณุฎุฉ ูู ูุงุญูุฉ ุงูุชููููุ",
        "ูุง ูู ุงููุณุฎุฉ ุงูููุงุณุจุฉ ููุฌูุงูุงุช ุงูุถุนููุฉุ"
    ])
    
    ูุณุงุจูุงุช[user_id] = ุงูููู
    ุฌุงุฆุฒุฉ = random.choice(ุฌูุงุฆุฒ_ูุณุงุจูุงุช)
    
    bot.reply_to(message, f"๐ฏ ุณุคุงู ุงูููู:\n{ุณุคุงู}\n\n๐ฐ ุงูุฌุงุฆุฒุฉ: {ุฌุงุฆุฒุฉ}\nุฃุฑุณู ุฅุฌุงุจุชู ุฎูุงู 5 ุฏูุงุฆู")

# ========== ูุธุงู ูุตุฉ ุชูุงุนููุฉ ==========
ูุตุต = {}
ูุตุต_ูุชุงุญุฉ = {
    "1": {
        "ุงุณู": "๐ซ ูููุฉ ุงูุฅููุงุฐ",
        "ูุดุงูุฏ": [
            "๐น ุชุจุฏุฃ ุงููููุฉ ูู ุงูุบุงุจุฉุ ุฃูุงูู ุทุฑููุงู...\n1. ุงูุฐูุงุจ ุดูุงููุง\n2. ุงูุฐูุงุจ ุฌููุจูุง",
            "๐น ูุตูุช ููุฑูุฉ ููุฌูุฑุฉุ ุชุณูุน ุตูุชูุง...\n1. ุชุฏุฎู ุงููุฑูุฉ\n2. ุชุชุฌุงูู ูุชููู",
            "๐น ุชุฌุฏ ุตูุฏูู ุฃุณูุญุฉ...\n1. ุชูุชุญู\n2. ุชุชุฑูู"
        ]
    }
}

@bot.message_handler(commands=['ูุตุฉ', 'story'])
def ุจุฏุงูุฉ_ูุตุฉ(message):
    user_id = message.from_user.id
    ูุตุต[user_id] = {
        "ุงููุตุฉ": "1",
        "ุงููุดูุฏ": 0,
        "ุงูุญุงูุฉ": "ุฌุงุฑู"
    }
    ูุตุฉ = ูุตุต_ูุชุงุญุฉ["1"]
    bot.reply_to(message, f"๐ {ูุตุฉ['ุงุณู']}\n\n{ูุตุฉ['ูุดุงูุฏ'][0]}\n\nุฃุฑุณู 1 ุฃู 2 ููุงุฎุชูุงุฑ")

# ========== ูุธุงู ุดุฎุตูุงุช ==========
@bot.message_handler(commands=['ุดุฎุตูุชู', 'personality'])
def ุชุบููุฑ_ุดุฎุตูุฉ(message):
    user_id = message.from_user.id
    user = ุฐุงูุฑุฉ.get(str(user_id), {})
    ุงูุดุฎุตูุฉ_ุงูุญุงููุฉ = user.get("ุงูุดุฎุตูุฉ", "ุฌุฏู")
    
    ูุต = f"๐ญ ุดุฎุตูุชู ุงูุญุงููุฉ: {ุดุฎุตูุงุช[ุงูุดุฎุตูุฉ_ุงูุญุงููุฉ]['ุงูููุฌู']} {ุงูุดุฎุตูุฉ_ุงูุญุงููุฉ}\n\nุงุฎุชุฑ ุดุฎุตูุฉ ุฌุฏูุฏุฉ:\n"
    for ุงุณู, ุจูุงูุงุช in ุดุฎุตูุงุช.items():
        ูุต += f"{ุจูุงูุงุช['ุงูููุฌู']} {ุงุณู} โ {ุจูุงูุงุช['ูุตู']}\n"
    ูุต += "\nุฃุฑุณู /set ุดุฎุตูุฉ"
    bot.reply_to(message, ูุต)

@bot.message_handler(commands=['set'])
def ุชุนููู_ุดุฎุตูุฉ(message):
    try:
        ุดุฎุตูุฉ = message.text.split()[1]
        if ุดุฎุตูุฉ in ุดุฎุตูุงุช:
            ุฐุงูุฑุฉ[str(message.from_user.id)]["ุงูุดุฎุตูุฉ"] = ุดุฎุตูุฉ
            ุญูุธ_json(ุฐุงูุฑุฉ_ุงููุณุชุฎุฏููู, ุฐุงูุฑุฉ)
            bot.reply_to(message, f"โ ุดุฎุตูุชู ุงูุฌุฏูุฏุฉ: {ุดุฎุตูุงุช[ุดุฎุตูุฉ]['ุงูููุฌู']} {ุดุฎุตูุฉ}")
        else:
            bot.reply_to(message, "โ ุดุฎุตูุฉ ุบูุฑ ูุชุงุญุฉ")
    except:
        bot.reply_to(message, "โ๏ธ ุงุณุชุฎุฏู: /set ุงูุดุฎุตูุฉ")

# ========== ูุธุงู ุชูุจููุงุช ุฐููุฉ ==========
@bot.message_handler(commands=['ุชูุจูู', 'alert'])
def ุชูุนูู_ุชูุจููุงุช(message):
    user_id = str(message.from_user.id)
    if user_id not in ุฐุงูุฑุฉ:
        ุฐุงูุฑุฉ[user_id] = {}
    
    ุฐุงูุฑุฉ[user_id]["ุชูุจููุงุช"] = True
    ุญูุธ_json(ุฐุงูุฑุฉ_ุงููุณุชุฎุฏููู, ุฐุงูุฑุฉ)
    bot.reply_to(message, "โ ุชู ุชูุนูู ุงูุชูุจููุงุชุ ุฑุงุญ ูุฑุณูู ุฅุดุนุงุฑุงุช ุนูุฏ ูุฒูู ูุณุฎ ุฌุฏูุฏุฉ")

# ========== ูุธุงู ุชูุงุฑูุฑ ููููุฉ ูููุทูุฑ ==========
def ุชูุฑูุฑ_ูููู():
    if datetime.now().hour == 8:  # ุงูุณุงุนุฉ 8 ุตุจุงุญูุง
        total = len(ุฐุงูุฑุฉ)
        ูุดุท_ุงูููู = sum(1 for u in ุฐุงูุฑุฉ.values() 
                       if datetime.fromisoformat(u.get('ุงุฎุฑ_ุฒูุงุฑุฉ', '2000-01-01')) > datetime.now() - timedelta(days=1))
        
        ุชูุฑูุฑ = f"""
๐ **ุงูุชูุฑูุฑ ุงููููู**:
โโโโโโโโโโโโโโโโ
๐ฅ ุฅุฌูุงูู ุงููุณุชุฎุฏููู: {total}
โจ ูุดุท ุงูููู: {ูุดุท_ุงูููู}
๐ฆ ุงููุณุฎ ุงูุฃูุซุฑ ุชุญููููุง: v2
โญ ูุชูุณุท ุงูุชููููุงุช: 4.7
โโโโโโโโโโโโโโโโ
        """
        try:
            bot.send_message(ADMIN_ID, ุชูุฑูุฑ)
        except:
            pass

# ========== ุงูุฑุฏ ุงูุฐูู ุงูุฑุฆูุณู ==========
def ุฑุฏ_ุฐูู(text, user_id, user_name):
    text = text.strip().lower()
    
    # ุชุญุฏูุซ ุงูุฐุงูุฑุฉ
    ุชุญุฏูุซ_ุงูุฐุงูุฑุฉ(user_id, user_name, text)
    ุงุถุงูุฉ_ุฎุจุฑุฉ(user_id, 5)
    
    # ุชุญูู ูู ุงูุฅูุฌุงุฒุงุช
    ููุฌุฒุงุช = ุชุญูู_ุงูุฌุงุฒุงุช(user_id)
    if ููุฌุฒุงุช:
        bot.send_message(user_id, f"๐ ุฅูุฌุงุฒ ุฌุฏูุฏ: {', '.join(ููุฌุฒุงุช)}")
    
    # ุชุญููู ุงููุดุงุนุฑ
    ูุดุงุนุฑ = ุชุญููู_ุงููุดุงุนุฑ(text)
    if ูุดุงุนุฑ != "ูุญุงูุฏ":
        ุฐุงูุฑุฉ[str(user_id)]["ุงููุดุงุนุฑ"].append(ูุดุงุนุฑ)
        if len(ุฐุงูุฑุฉ[str(user_id)]["ุงููุดุงุนุฑ"]) > 10:
            ุฐุงูุฑุฉ[str(user_id)]["ุงููุดุงุนุฑ"].pop(0)
    
    # ุฑุฏ ุนุงุทูู
    if random.random() < 0.3:  # 30% ุฑุฏูุฏ ุนุงุทููุฉ
        ุนุงุทูู = ุฑุฏ_ุนุงุทูู(ูุดุงุนุฑ, user_name)
        return ุนุงุทูู
    
    # ุดุฎุตูุฉ ุงููุณุชุฎุฏู
    ุดุฎุตูุฉ = ุฐุงูุฑุฉ[str(user_id)].get("ุงูุดุฎุตูุฉ", "ุฌุฏู")
    
    # ===== ุชุญูุงุช =====
    if any(word in text for word in ["ุงูุณูุงู", "ุณูุงู", "hi", "hello", "ูุฑุญุจุง", "ููุง"]):
        return f"{ุดุฎุตูุงุช[ุดุฎุตูุฉ]['ุงูููุฌู']} ูุนูููู ุงูุณูุงูุ ุฃููุงู {user_name}\nูุณุชูุงู: {ุฐุงูุฑุฉ[str(user_id)]['ุงููุณุชูู']}"
    
    # ===== ููู ุงูุชุญููู =====
    if any(word in text for word in ["ููู ุงูุชุญููู", "ููู ุงุญูู", "ุฑุงุจุท"]):
        return "โฌ๏ธ ูู ุงูุฑูุงุจุท:\nhttps://t.me/kenan_mod_2"
    
    # ===== ุงูุชุฑุงุญ ูุณุฎุฉ =====
    if "ุงูุชุฑุญ" in text or "ุฌุฑุจ" in text:
        ุงููุชุงุญุฉ = [v for k, v in ูุณุฎ_ุจุจุฌู.items() if v['ููุฏ'] != "โ ูุง ููุฌุฏ ููุฏ ุจุนุฏ"]
        if ุงููุชุงุญุฉ:
            v = random.choice(ุงููุชุงุญุฉ)
            return f"๐ฏ ุฃูุชุฑุญ ุนููู:\n{v['ุงุณู']}\nโญ ุชูููู: {v['ุชูููู']}/5\n๐ {v['ููุฏ']}"
    
    # ===== ุนุฑุถ ุงูุชููููุงุช =====
    if "ุงูุถู ูุณุฎุฉ" in text or "ุฃูุถู ูุณุฎุฉ" in text:
        ุงูุถู = sorted(ูุณุฎ_ุจุจุฌู.items(), key=lambda x: x[1]['ุชูููู'], reverse=True)[0]
        return f"๐ ุฃูุถู ูุณุฎุฉ ุญุณุจ ุงูุชููููุงุช:\n{ุงูุถู[1]['ุงุณู']} โญ {ุงูุถู[1]['ุชูููู']}/5"
    
    # ===== ุชููุน =====
    if "ุชููุน" in text or "ุชููุนุงุช" in text:
        return ุชููุน_ุฐูู()
    
    # ===== ุฎุจุฑุชู =====
    if "ุฎุจุฑุชู" in text or "ูุณุชูุงู" in text:
        ุฎุจุฑุฉ = ุฐุงูุฑุฉ[str(user_id)].get("ุงูุฎุจุฑุฉ", 0)
        ูุณุชูู = ุฐุงูุฑุฉ[str(user_id)].get("ุงููุณุชูู", 1)
        return f"๐ ูุณุชูุงู: {ูุณุชูู}\nโจ ุฎุจุฑุชู: {ุฎุจุฑุฉ}"
    
    # ===== ุงูุฌุงุฒุงุชู =====
    if "ุงูุฌุงุฒุงุชู" in text or "achievements" in text:
        user_achievements = ุฐุงูุฑุฉ[str(user_id)].get("ุงูุงูุฌุงุฒุงุช", [])
        if user_achievements:
            names = [ุงูุฌุงุฒุงุช_ุงููู.get(a, {}).get("ุงุณู", a) for a in user_achievements]
            return f"๐ ุงูุฌุงุฒุงุชู:\n" + "\n".join(names)
        else:
            return "๐ญ ูุง ุนูุฏู ุงูุฌุงุฒุงุช ุจุนุฏ"
    
    # ===== ุฅุฐุง ูุง ููู =====
    return None

# ========== ุงุณุชูุจุงู ุงูุฑุณุงุฆู ูุงูุฑุฏ ุงูุฐูู ==========
@bot.message_handler(func=lambda message: True)
def ุงูุฑุฏ_ุงูุฐูู(message):
    if message.text is None:
        return
    
    # ุฑุฏูุฏ ุงููุตุฉ ุงูุชูุงุนููุฉ
    if message.from_user.id in ูุตุต and ูุตุต[message.from_user.id]["ุงูุญุงูุฉ"] == "ุฌุงุฑู":
        if message.text in ["1", "2"]:
            ูุตุฉ = ูุตุต_ูุชุงุญุฉ[ูุตุต[message.from_user.id]["ุงููุตุฉ"]]
            ูุดูุฏ = ูุตุต[message.from_user.id]["ุงููุดูุฏ"]
            
            if ูุดูุฏ < len(ูุตุฉ["ูุดุงูุฏ"]) - 1:
                ูุตุต[message.from_user.id]["ุงููุดูุฏ"] += 1
                bot.reply_to(message, ูุตุฉ["ูุดุงูุฏ"][ูุดูุฏ + 1])
            else:
                ูุตุต[message.from_user.id]["ุงูุญุงูุฉ"] = "ุงูุชูุช"
                bot.reply_to(message, "๐ ูุจุฑูู! ุฃูููุช ุงููุตุฉ")
            return
    
    ุฑุฏ = ุฑุฏ_ุฐูู(message.text, message.from_user.id, message.from_user.first_name)
    if ุฑุฏ:
        bot.reply_to(message, ุฑุฏ)

# ========== ุฃูุฑ code ==========
@bot.message_handler(commands=['code'])
def ููุฏ_ูุณุฎุฉ(message):
    try:
        ุฑูู = int(message.text.split()[1])
        if ุฑูู in [1, 2, 3]:
            v = ูุณุฎ_ุจุจุฌู[f"v{ุฑูู}"]
            ุฐุงูุฑุฉ[str(message.from_user.id)]["ุงุฎุฑ_ูุณุฎุฉ"] = v['ุงุณู']
            ุญูุธ_json(ุฐุงูุฑุฉ_ุงููุณุชุฎุฏููู, ุฐุงูุฑุฉ)
            ุงุถุงูุฉ_ุฎุจุฑุฉ(message.from_user.id, 30)
            bot.reply_to(message, f"๐ ููุฏ ูุณุฎุฉ {ุฑูู}:\n{v['ููุฏ']}\n๐ {v['ููุน_ุงูุฏุฎูู']}\nโญ ุชูููู: {v['ุชูููู']}/5")
        else:
            bot.reply_to(message, "โ ูุฐุง ุงูุฑูู ุบูุฑ ููุฌูุฏ")
    except:
        bot.reply_to(message, "โ๏ธ ุงุณุชุฎุฏู: /code ุฑูู ุงููุณุฎุฉ (1,2,3)")

# ========== ุฃูุฑ start ุงูุฑุฆูุณู ==========
@bot.message_handler(commands=['start'])
def start(message):
    uid = message.from_user.id
    name = message.from_user.first_name
    ุชุญุฏูุซ_ุงูุฐุงูุฑุฉ(uid, name, "/start")
    
    if len(message.text.split()) > 1:
        ููุฏ = message.text.split()[1]
        if ููุฏ in ูุณุฎ_ุจุจุฌู:
            v = ูุณุฎ_ุจุจุฌู[ููุฏ]
            if ูุดุชุฑู(uid):
                if v['ููุฏ'] != "โ ูุง ููุฌุฏ ููุฏ ุจุนุฏ":
                    ุฐุงูุฑุฉ[str(uid)]["ุงุฎุฑ_ูุณุฎุฉ"] = v['ุงุณู']
                    ุญูุธ_json(ุฐุงูุฑุฉ_ุงููุณุชุฎุฏููู, ุฐุงูุฑุฉ)
                    ุงุถุงูุฉ_ุฎุจุฑุฉ(uid, 50)
                    bot.send_message(uid, f"{v['ุงุณู']}\nโโโโโโโโโโโโโโ\n๐ฆ {v['ุญุฌู']}\n{v['ูุตู']}\nโญ {v['ุชูููู']}/5\nโโโโโโโโโโโโโโ\nโฌ๏ธ {v['ููุฏ']}\n๐ {v['ููุน_ุงูุฏุฎูู']}", disable_web_page_preview=False)
            else:
                ุฒุฑ = telebot.types.InlineKeyboardMarkup()
                ุฒุฑ.add(telebot.types.InlineKeyboardButton("๐ข ุงุดุชุฑู", url=CHANNEL_LINK))
                bot.send_photo(uid, photo=ุฑุงุจุท_ุงูุตูุฑุฉ(v['ุตูุฑุฉ']), caption=f"{v['ุงุณู']}\nโโโโโโโโโโโโโโ\n๐ฆ {v['ุญุฌู']}\n{v['ูุตู']}\nโโโโโโโโโโโโโโ\nโ๏ธ ุงุดุชุฑู ุฃููุงู", reply_markup=ุฒุฑ)
    else:
        if ูุดุชุฑู(uid):
            ุฒุฑ = telebot.types.InlineKeyboardMarkup(row_width=1)
            for k, v in ูุณุฎ_ุจุจุฌู.items():
                if v['ููุฏ'] != "โ ูุง ููุฌุฏ ููุฏ ุจุนุฏ":
                    ุฒุฑ.add(telebot.types.InlineKeyboardButton(f"{v['ุงุณู']} โญ {v['ุชูููู']}", url=f"https://t.me/GSNMODBOT?start={k}"))
            
            ูุณุชูู = ุฐุงูุฑุฉ[str(uid)].get("ุงููุณุชูู", 1)
            bot.reply_to(message, f"๐น ูุฑุญุจูุง {name} (ุงููุณุชูู {ูุณุชูู})\nุงุฎุชุฑ ูุณุฎุชู:", reply_markup=ุฒุฑ)
        else:
            ุฒุฑ = telebot.types.InlineKeyboardMarkup()
            ุฒุฑ.add(telebot.types.InlineKeyboardButton("๐ข ุงุดุชุฑู", url=CHANNEL_LINK))
            bot.send_photo(uid, photo=ุฑุงุจุท_ุงูุตูุฑุฉ("https://t.me/kenan_mod_2/36"), caption=f"โ๏ธ ุงุดุชุฑู ุฃูููุง ูุง {name}", reply_markup=ุฒุฑ)

# ========== ุฅุญุตุงุฆูุงุช ุงููุทูุฑ ==========
@bot.message_handler(commands=['ุงุญุตุงุฆูุงุช', 'stats'])
def ุงุญุตุงุฆูุงุช_ุงููุทูุฑ(message):
    if message.from_user.id != ADMIN_ID:
        return
    
    total = len(ุฐุงูุฑุฉ)
    ูุดุท = sum(1 for u in ุฐุงูุฑุฉ.values() 
             if datetime.fromisoformat(u.get('ุงุฎุฑ_ุฒูุงุฑุฉ', '2000-01-01')) > datetime.now() - timedelta(days=7))
    
    ูุชูุณุท_ุชูููู = sum(v['ุชูููู'] for v in ูุณุฎ_ุจุจุฌู.values() if v['ุชูููู'] > 0) / len([v for v in ูุณุฎ_ุจุจุฌู.values() if v['ุชูููู'] > 0])
    
    text = f"""
๐ **ุฅุญุตุงุฆูุงุช ุงูุจูุช ุงูุฃุณุทูุฑู**:
โโโโโโโโโโโโโโโโ
๐ฅ ุฅุฌูุงูู ุงููุณุชุฎุฏููู: {total}
๐ ุงููุดุทูู ุขุฎุฑ 7 ุฃูุงู: {ูุดุท}
๐ฆ ุนุฏุฏ ุงููุณุฎ: {len(ูุณุฎ_ุจุจุฌู)}
โญ ูุชูุณุท ุงูุชูููู: {round(ูุชูุณุท_ุชูููู, 1)}/5
๐ง ูุงุนุฏุฉ ุงููุดุงูู: {len(ูุงุนุฏุฉ_ูุดุงูู)}
๐ ุงูุฅูุฌุงุฒุงุช: {len(ุงูุฌุงุฒุงุช_ุงููู)}
โโโโโโโโโโโโโโโโ
    """
    bot.reply_to(message, text)

# ========== ุญููุฉ ุงูุชูุฑูุฑ ุงููููู ==========
def ุญููุฉ_ุงูุชูุงุฑูุฑ():
    while True:
        ุชูุฑูุฑ_ูููู()
        time.sleep(3600)  # ูู ุณุงุนุฉ

# ========== ุชุดุบูู ุงูุจูุช ==========
if __name__ == "__main__":
    import threading
    threading.Thread(target=ุญููุฉ_ุงูุชูุงุฑูุฑ, daemon=True).start()
    
    print("๐ ุงูุจูุช ุงูุฃุณุทูุฑู ุดุบุงู โ")
    print(f"๐ง ุฐุงูุฑุฉ: {len(ุฐุงูุฑุฉ)} ูุณุชุฎุฏู")
    print(f"๐ฆ ูุงุนุฏุฉ ูุดุงูู: {len(ูุงุนุฏุฉ_ูุดุงูู)}")
    print(f"โญ ุชููููุงุช: {len(ุชููููุงุช)}")
    print(f"๐ ุงูุฌุงุฒุงุช: {len(ุงูุฌุงุฒุงุช_ุงููู)}")
    
    while True:
        try:
            bot.polling(none_stop=True)
        except Exception as e:
            print(f"ุฎุทุฃ: {e}")
            time.sleep(3)
